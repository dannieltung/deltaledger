<div class="home-container">
  <div class="home-card">
    <div class="calculator-form-container" style="border: 1px solid red" data-controller="calculator">
      <h3 class="trade-form-title">
        <i class="bi bi-calculator"></i>
        Yield do Prêmio
      </h3>
      <div class="trade-form">
        <div class="trade-form-row">
          <div class="trade-form-group">
            <label class="trade-label">Strike</label>
            <input
              type="text"
              class="trade-input"
              placeholder="0,00"
              data-calculator-target="strike"
              data-action="input->calculator#formatInput input->calculator#calculate"
              >
            </div>
            <div class="trade-form-group">
              <label class="trade-label">Prêmio</label>
              <input
              type="text"
              class="trade-input"
              placeholder="0,00"
              data-calculator-target="premium"
              data-action="input->calculator#formatInput input->calculator#calculate"
                >
              </div>
              <div class="trade-form-group trade-form-group-centered">
                <label class="trade-label">Yield</label>
                <div class="trade-input" data-calculator-target="result" style="background-color: #f5f5f5;">0.00%</div>
              </div>
            </div>
          </div>
        </div>
        <% if user_signed_in? %>
          <div class="trade-form-container">
            <h3 class="trade-form-title">
              <i class="bi bi-plus-circle"></i>
              Operação
            </h3>
            <div id="flash_messages"></div>
            <%= simple_form_for @option_trade, url: option_trades_path, html: { class: 'trade-form', id: 'option_trade_form' } do |f| %>
              <div class="trade-form-row">
                <div class="trade-form-group">
                  <%= f.input :trade_date,
                            as: :string,
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: {
                              class: 'trade-input',
                              placeholder: 'DD/MM/AA',
                              data: {
                                controller: 'date-input',
                                date_input_auto_fill_value: true,
                                action: 'input->date-input#input paste->date-input#paste blur->date-input#blur'
                              }
                            } %>
                </div>
                <div class="trade-form-group">
                  <%= f.input :operation_type,
                            collection: [['Compra', 'buy'], ['Venda', 'sell']],
                            selected: 'sell',
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: { class: 'trade-input' } %>
                </div>
                <div class="trade-form-group">
                  <%= f.input :option_type,
                            collection: [['CALL', 'call'], ['PUT', 'put']],
                            selected: 'put',
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: { class: 'trade-input' } %>
                </div>
              </div>
              <div class="trade-form-row">
                <div class="trade-form-group">
                  <%= f.input :quantity,
                            as: :string,
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: {
                              class: 'trade-input',
                              placeholder: '100',
                              data: {
                                controller: 'integer-input',
                                action: 'input->integer-input#input paste->integer-input#paste'
                              }
                            } %>
                </div>
                <div class="trade-form-group">
                  <%= f.input :option_code,
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: {
                              class: 'trade-input',
                              placeholder: 'Ex: PETRC50',
                              data: {
                                controller: 'option-code',
                                action: 'input->option-code#input paste->option-code#paste'
                              }
                            } %>
                </div>
                <div class="trade-form-group">
                  <%= f.input :strike_price,
                            as: :string,
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: {
                              class: 'trade-input',
                              placeholder: '0,00',
                              data: {
                                controller: 'currency-input',
                                action: 'input->currency-input#input paste->currency-input#paste'
                              }
                            } %>
                </div>
              </div>
              <div class="trade-form-row">
                <div class="trade-form-group">
                  <%= f.input :premium,
                            as: :string,
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: {
                              class: 'trade-input',
                              placeholder: '0,00',
                              data: {
                                controller: 'currency-input',
                                action: 'input->currency-input#input paste->currency-input#paste'
                              }
                            } %>
                </div>
                <div class="trade-form-group">
                  <%= f.input :expiration_date,
                            as: :string,
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: {
                              class: 'trade-input',
                              placeholder: 'DD/MM/AA',
                              data: {
                                controller: 'date-input',
                                action: 'input->date-input#input paste->date-input#paste'
                              }
                            } %>
                </div>
                <div class="trade-form-group">
                  <%= f.input :underlying_asset,
                            wrapper: false,
                            required: false,
                            label_html: { class: 'trade-label' },
                            input_html: { class: 'trade-input', placeholder: 'Ex: PETR4', data: {
                              controller: 'option-code',
                              action: 'input->option-code#input paste->option-code#paste'
                            } } %>
                </div>
              </div>
              <div class="trade-form-actions">
                <%= f.button :submit, "Registrar Operação", class: "trade-submit-btn" %>
              </div>
            <% end %>
          </div>
        <% end %>
        <% if user_signed_in? && @option_trades.present? %>
          <div class="trades-list-container">
            <h3 class="trade-form-title">
              <i class="bi bi-list-ul"></i>
              Minhas Operações
            </h3>
            <div class="trades-table-wrapper">
              <table class="trades-table">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Código</th>
                    <th>Tipo</th>
                    <th>Operação</th>
                    <th>Qtd</th>
                    <th>Strike</th>
                    <th>Prêmio</th>
                    <th>Vencimento</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody id="option_trades_tbody">
                  <% @option_trades.each do |trade| %>
                    <%= render partial: "option_trades/option_trade_row", locals: { option_trade: trade } %>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        <% end %>
      </div>
    </div>
