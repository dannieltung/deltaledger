<%= turbo_stream.prepend "option_trades_tbody", partial: "option_trades/option_trade_row", locals: { option_trade: @option_trade } %>
<%= turbo_stream.update "option_trade_form" do %>
  <%= simple_form_for OptionTrade.new, url: option_trades_path, html: { class: 'trade-form', id: 'option_trade_form', data: { controller: 'autofill-trade input-validator', autofill_trade_url_value: search_by_code_path } } do |f| %>
    <div class="trade-form-row">
      <div class="trade-form-group">
        <%= f.input :trade_date,
                  as: :string,
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: {
                    class: 'trade-input',
                    placeholder: 'DD/MM/AA',
                    data: {
                      controller: 'date-input',
                      date_input_auto_fill_value: true,
                      action: 'input->date-input#input paste->date-input#paste blur->date-input#blur'
                    }
                  } %>
      </div>
      <div class="trade-form-group">
        <%= f.input :operation_type,
                  collection: [['Compra', 'buy'], ['Venda', 'sell']],
                  selected: 'sell',
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: { class: 'trade-input' } %>
      </div>
      <div class="trade-form-group">
        <%= f.input :option_type,
                  collection: [['CALL', 'call'], ['PUT', 'put']],
                  selected: 'put',
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: { class: 'trade-input' } %>
      </div>
    </div>
    <div class="trade-form-row">
      <div class="trade-form-group">
        <%= f.input :quantity,
                  as: :string,
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: {
                    class: 'trade-input',
                    placeholder: '100',
                    data: {
                      controller: 'integer-input',
                      input_validator_target: 'input',
                      action: 'input->integer-input#input input->input-validator#validate paste->integer-input#paste change->input-validator#validate'
                    }
                  } %>
      </div>
      <div class="trade-form-group">
        <%= f.input :option_code,
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: {
                    class: 'trade-input',
                    placeholder: 'Ex: PETRC50',
                    data: {
                      controller: 'option-code',
                      autofill_trade_target: 'optionCode',
                      input_validator_target: 'input',
                      action: 'input->option-code#input input->autofill-trade#search input->input-validator#validate paste->option-code#paste change->input-validator#validate'
                    }
                  } %>
      </div>
      <div class="trade-form-group">
        <%= f.input :expiration_date,
                  as: :string,
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: {
                    class: 'trade-input',
                    placeholder: 'DD/MM/AA',
                    data: {
                      controller: 'date-input',
                      autofill_trade_target: 'expirationDate',
                      input_validator_target: 'input',
                      action: 'input->date-input#input input->input-validator#validate paste->date-input#paste change->input-validator#validate'
                    }
                  } %>
      </div>
    </div>
    <div class="trade-form-row">
      <div class="trade-form-group">
        <%= f.input :underlying_asset,
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: {
                    class: 'trade-input',
                    placeholder: 'Ex: PETR4',
                    data: {
                      controller: 'option-code',
                      autofill_trade_target: 'underlyingAsset',
                      input_validator_target: 'input',
                      action: 'input->option-code#input input->input-validator#validate paste->option-code#paste change->input-validator#validate'
                    }
                  } %>
      </div>
      <div class="trade-form-group">
        <%= f.input :strike_price,
                  as: :string,
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: {
                    class: 'trade-input',
                    placeholder: '0,00',
                    data: {
                      controller: 'currency-input',
                      copy_values_target: 'strikeDestination',
                      autofill_trade_target: 'strikePrice',
                      input_validator_target: 'input',
                      action: 'input->currency-input#input input->input-validator#validate paste->currency-input#paste change->input-validator#validate'
                    }
                  } %>
      </div>
      <div class="trade-form-group">
        <%= f.input :premium,
                  as: :string,
                  wrapper: false,
                  required: false,
                  label_html: { class: 'trade-label' },
                  input_html: {
                    class: 'trade-input',
                    placeholder: '0,00',
                    data: {
                      controller: 'currency-input',
                      copy_values_target: 'premiumDestination',
                      input_validator_target: 'input',
                      action: 'input->currency-input#input input->input-validator#validate paste->currency-input#paste change->input-validator#validate'
                    }
                  } %>
      </div>
    </div>
    <div class="trade-form-actions">
      <%= f.button :submit, "Registrar Operação", class: "trade-submit-btn" %>
    </div>
  <% end %>
<% end %>
<%= turbo_stream.prepend "flash_container" do %>
  <div class="flash-notice" data-controller="flash">
    Trade criado com sucesso!
    <button class="flash-close" onclick="this.parentElement.remove()">×</button>
  </div>
<% end %>
